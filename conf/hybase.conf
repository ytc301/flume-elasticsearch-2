# hybase.conf: A single-node Flume configuration

# Name the components on this agent
agent.sources = hybase
agent.channels = hotspot_channel warehouse_channel
agent.sinks = forward_to_hotspot forword_to_warehouse

agent.sources.hybase.channels = hotspot_channel warehouse_channel
agent.sources.hybase.selector.type = replicating


agent.sinks.forward_to_hotspot.channel = hotspot_channel
agent.sinks.forword_to_warehouse.channel = warehouse_channel


agent.sources.hybase.type = com.trs.smas.flume.TRSHybaseSource
agent.sources.hybase.url = http://192.168.200.12:5555
agent.sources.hybase.username = datasearch2013nov
agent.sources.hybase.password = hybasesearch@)!#nov2013
agent.sources.hybase.database = dc_chuantong_0819
agent.sources.hybase.filter = HYBASE_LOADTIME_A:["2014/05/04 09:00:00" TO "2014/05/04 10:00:00"]
agent.sources.hybase.watermark = HYBASE_LOADTIME_A
agent.sources.hybase.from = 2014/05/04 08:55:00
agent.sources.hybase.partition = IR_URLDATE
agent.sources.hybase.delay = -10
agent.sources.hybase.range = 30
agent.sources.hybase.step = 60
agent.sources.hybase.batchSize = 10000
agent.sources.hybase.headers = IR_GROUPNAME;IR_URLDATE
agent.sources.hybase.exportTmp = /home/spark/apps/apache-flume-1.4.0-bin/data/sources/
agent.sources.hybase.checkpoint = /home/spark/apps/apache-flume-1.4.0-bin/data/sources/checkpoint
agent.sources.hybase.body = <REC>\n<IR_ABSTRACT>={IR_ABSTRACT}\n<IR_AUTHORS>={IR_AUTHORS}\n<IR_BBSNUM>={IR_BBSNUM}\n<IR_CATALOG>={IR_CATALOG}\n<IR_CATALOG1>={IR_CATALOG1}\n<IR_CATALOG2>={IR_CATALOG2}\n<IR_CHANNEL>={IR_CHANNEL}\n<IR_CHARSET>={IR_CHARSET}\n<IR_CONTENT>={IR_CONTENT}\n<IR_DELEOPERATOR>={IR_DELEOPERATOR}\n<IR_DELETIME>={IR_DELETIME}\n<IR_DISTRICT>={IR_DISTRICT}\n<IR_DOCLENGTH>={IR_DOCLENGTH}\n<IR_EXPORTID>={IR_EXPORTID}\n<IR_EXPORTNAME>={IR_EXPORTNAME}\n<IR_EXPORTTYPE>={IR_EXPORTTYPE}\n<IR_EXTNAME>={IR_EXTNAME}\n<IR_FORMAT>={IR_FORMAT}\n<IR_GROUPNAME>={IR_GROUPNAME}\n<IR_HKEY>={IR_HKEY}\n<IR_IMAGEFLAG>={IR_IMAGEFLAG}\n<IR_ISTRASH>={IR_ISTRASH}\n<IR_KEYWORDS>={IR_KEYWORDS}\n<IR_LASTTIME>={IR_LASTTIME}\n<IR_LOADTIME>={IR_LOADTIME}\n<IR_MIMETYPE>={IR_MIMETYPE}\n<IR_NRESERVED1>={IR_NRESERVED1}\n<IR_NRESERVED2>={IR_NRESERVED2}\n<IR_NRESERVED3>={IR_NRESERVED3}\n<IR_PAGELEVEL>={IR_PAGELEVEL}\n<IR_PAGERANK>={IR_PAGERANK}\n<IR_PKEY>={IR_PKEY}\n<IR_PUBTYPE>={IR_PUBTYPE}\n<IR_SERVICEID>={IR_SERVICEID}\n<IR_SID>={IR_SID}\n<IR_SIMFLAG>={IR_SIMFLAG}\n<IR_SIMRANK>={IR_SIMRANK}\n<IR_SITENAME>={IR_SITENAME}\n<IR_SRCNAME>={IR_SRCNAME}\n<IR_SRESERVED1>={IR_SRESERVED1}\n<IR_SRESERVED2>={IR_SRESERVED2}\n<IR_SRESERVED3>={IR_SRESERVED3}\n<IR_STARTID>={IR_STARTID}\n<IR_STATUS>={IR_STATUS}\n<IR_TABLEFLAG>={IR_TABLEFLAG}\n<IR_URLBODY>={IR_URLBODY}\n<IR_URLCONTENT>={IR_URLCONTENT}\n<IR_URLDATE>={IR_URLDATE}\n<IR_URLIMAGE>={IR_URLIMAGE}\n<IR_URLLEVEL>={IR_URLLEVEL}\n<IR_URLNAME>={IR_URLNAME}\n<IR_URLSIZE>={IR_URLSIZE}\n<IR_URLTABLE>={IR_URLTABLE}\n<IR_URLTIME>={IR_URLTIME}\n<IR_URLTITLE>={IR_URLTITLE}\n<IR_URLTOPIC>={IR_URLTOPIC}\n<IR_VRESERVED1>={IR_VRESERVED1}\n<IR_VRESERVED2>={IR_VRESERVED2}\n<IR_VRESERVED3>={IR_VRESERVED3}\n<IR_VRESERVED4>={IR_VRESERVED4}\n<IR_WCMID>={IR_WCMID}\n<CATALOG_AREA>={CATALOG_AREA}\n<MD5TAG>={MD5TAG}\n<SIMFLAG>={SIMFLAG}\n<SIMID>={SIMID}\n<TITLE_SIMFLAG>={TITLE_SIMFLAG}\n<TITLE_SIMID>={TITLE_SIMID}\n<URLNAMEMD5>={URLNAMEMD5}\n<CLICK_NUM>={CLICK_NUM}\n<REPLY_NUM>={REPLY_NUM}\n<BROWSE_NUM>={BROWSE_NUM}\n<IR_HY_LOADTIME>={IR_HY_LOADTIME}\n<IR_URLTIME_YEAR>={IR_URLTIME_YEAR}\n<IR_URLTIME_MONTH>={IR_URLTIME_MONTH}\n<IR_URLTIME_HOUR>={IR_URLTIME_HOUR}\n<SIMNUM>={SIMNUM}\n<TITLE_SIMNUM>={TITLE_SIMNUM}\n<IR_ADDITION_CHAR1>={IR_ADDITION_CHAR1}\n<IR_ADDITION_CHAR2>={IR_ADDITION_CHAR2}\n<IR_ADDITION_CHAR3>={IR_ADDITION_CHAR3}\n<IR_ADDITION_NUM1>={IR_ADDITION_NUM1}\n<IR_ADDITION_PHRASE1>={IR_ADDITION_PHRASE1}\n<IR_ADDITION_DOC1>={IR_ADDITION_DOC1}\n<IR_ADDITION_DATE1>={IR_ADDITION_DATE1}\n<ADDTION_CATALOG_DATA>={ADDTION_CATALOG_DATA}\n<ADDITION_CATALOG_CONCATA>={ADDITION_CATALOG_CONCATA}\n

agent.sources.hybase.interceptors = group_normalizer date_normalizer
agent.sources.hybase.interceptors.group_normalizer.type = com.trs.smas.flume.RegexMapperInterceptor$Builder
agent.sources.hybase.interceptors.group_normalizer.from = IR_GROUPNAME
agent.sources.hybase.interceptors.group_normalizer.to = .group
agent.sources.hybase.interceptors.group_normalizer.mapping.news = ^国内新闻
agent.sources.hybase.interceptors.group_normalizer.mapping.forum = ^国内论坛
agent.sources.hybase.interceptors.group_normalizer.default = other

agent.sources.hybase.interceptors.date_normalizer.type = com.trs.smas.flume.RegexMapperInterceptor$Builder
agent.sources.hybase.interceptors.date_normalizer.from = IR_URLDATE
agent.sources.hybase.interceptors.date_normalizer.to = .month
agent.sources.hybase.interceptors.date_normalizer.mapping.201405 = ^2014/05
agent.sources.hybase.interceptors.date_normalizer.mapping.201404 = ^2014/04
agent.sources.hybase.interceptors.date_normalizer.mapping.201403 = ^2014/03
agent.sources.hybase.interceptors.date_normalizer.mapping.201402 = ^2014/02
agent.sources.hybase.interceptors.date_normalizer.mapping.201401 = ^2014/01
agent.sources.hybase.interceptors.date_normalizer.default = history


agent.sinks.forward_to_hotspot.type = avro
agent.sinks.forward_to_hotspot.hostname = 127.0.0.1
agent.sinks.forward_to_hotspot.port = 10000

agent.sinks.forword_to_warehouse.type = avro
agent.sinks.forword_to_warehouse.hostname = 127.0.0.1
agent.sinks.forword_to_warehouse.port = 11000

agent.channels.hotspot_channel.type = file
agent.channels.hotspot_channel.checkpointDir = /home/spark/apps/apache-flume-1.4.0-bin/data/hotspot_channel/checkpoint
agent.channels.hotspot_channel.dataDirs = /home/spark/apps/apache-flume-1.4.0-bin/data/hotspot_channel/data
agent.channels.hotspot_channel.write-timeout = 60
agent.channels.hotspot_channel.capacity = 100000
agent.channels.hotspot_channel.transactionCapacity = 10000

agent.channels.warehouse_channel.type = file
agent.channels.warehouse_channel.checkpointDir = /home/spark/apps/apache-flume-1.4.0-bin/data/warehouse_channel/checkpoint
agent.channels.warehouse_channel.dataDirs = /home/spark/apps/apache-flume-1.4.0-bin/data/warehouse_channel/data
agent.channels.warehouse_channel.write-timeout = 60
agent.channels.warehouse_channel.capacity = 100000
agent.channels.warehouse_channel.transactionCapacity = 10000
